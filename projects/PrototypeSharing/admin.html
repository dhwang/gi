<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Prototype Library Administration</title>
    <style type="text/css">
		@import "../jsclient/dojo/resources/dojo.css";
		@import "../jsclient/dojox/grid/resources/Grid.css";
		@import "../jsclient/dojox/grid/resources/tundraGrid.css";
		@import "../jsclient/dijit/themes/tundra/tundra.css";
      body {
        margin: 0 0 25px 0;
        margin-bottom: 25px;
        padding: 0;
        font-family: "Lucida Grande", "Bitstream Vera Sans", "Verdana";
        font-size: 13px;
        color: #333;
        background-color: #f0f0f0;
      }
      #content {
        background-color: white;
        width: 750px;
        margin: 0;
        padding: 25px 0 25px 10px;
        margin-left: auto;
        margin-right: auto;
        border: 1px solid #aaa;
        border-top: none;
      }
    </style>
  	<script djConfig="isDebug:true, parseOnLoad: true" src="../jsclient/dojo/dojo.js" type="text/javascript"></script>
	<script type="text/javascript">
		var path = location.pathname.match(/(.*\/)[^\/]*$/)[1];
		//dojo.require("dojox.data.ClientFilter");
		dojo.require("dojo.cookie");
		dojo.require("dojox.data.PersevereStore");
		dojo.require("dojox.grid.DataGrid");
		dojo.require("dijit.layout.BorderContainer");
		dojo.require("dijit.layout.TabContainer");
		dojo.require("dijit.layout.ContentPane");
		
		var prototypeStore = new dojox.data.PersevereStore({target:"/data/Prototype/",schema:{prototype:{a:3}}}); // persevere stores are auto-generated
		function requery(status){
			componentGrid.setQuery({status:status});
		}
		function setText(element, text){
			element.innerHTML = text.replace(/</,"&lt;");
		}
		dojo.addOnLoad(function(){
			dojo.connect(componentGrid,"onRowClick", function(event){
				selectedItem = event.grid.getItem(event.rowIndex);
				infoTab.attr("content", "description: " + prototypeStore.getValue(selectedItem, "description"));
				sourceTab.attr("content", prototypeStore.getValue(selectedItem, "component").replace(/</,"&lt;"));
				setText(dojo.byId("author-detail"), prototypeStore.getValue(selectedItem, "author"));
				setText(dojo.byId("status-detail"), prototypeStore.getValue(selectedItem, "status"));
				setText(dojo.byId("version-detail"), prototypeStore.getValue(selectedItem, "version"));
				setText(dojo.byId("downloads-detail"), prototypeStore.getValue(selectedItem, "downloads"));
				setText(dojo.byId("uploaded-detail"), prototypeStore.getValue(selectedItem, "uploaded"));
				setText(dojo.byId("rating-detail"), prototypeStore.getValue(selectedItem, "rating"));
				setText(dojo.byId("category-detail"), prototypeStore.getValue(selectedItem, "category"));
			});
			var tabElement = infoPane.tablistWrapper.firstChild;
			tabElement.style.width = "100%";
			tabElement.appendChild(dojo.byId("component-actions"));
			setText(dojo.byId("username"), "John Adams");
			
			dojo.connect(dojo.byId("download"), "onclick", function(){
				var id = prototypeStore.getIdentity(selectedItem);
				window.location.href = "/data/Prototype/" + id + ".component";
			});
			dojo.connect(dojo.byId("accept-button"), "onclick", function(){
				var id = prototypeStore.getIdentity(selectedItem);
				dojo.xhrPost({
					url: "/data/Prototype/" + id,
					postData: dojo.toJson({status:"accepted"})
				});
			});
			dojo.connect(dojo.byId("reject-button"), "onclick", function(){
				var id = prototypeStore.getIdentity(selectedItem);
				dojo.xhrPost({
					url: "/data/Prototype/" + id,
					postData: dojo.toJson({status:"rejected"})
				});
			});
		});
	</script>
</head>
  
  <body class="tundra">
  		<div id="app-border" dojoType="dijit.layout.BorderContainer"
		style="width: 90%; height: 100%; border: 2px solid blue; ">
        <div id="header-pane" dojoType="dijit.layout.ContentPane" splitter="true" region="top" style="height:100px">
	      <h1>General Interface</h1>
		  <h2>Prototype Library Administration</h2>
		</div>
		<div dojoType="dijit.layout.TabContainer" region="center" style="background-color: #f5ffbf; padding: 30px;">
			<div id="user">
				<span id="username"></span>
				<span class="horizontal-rule"></span>
				<span id="logout">Logout</span>
			</div>
	  		<div id="component-border" dojoType="dijit.layout.BorderContainer" title="Components"
			style="width: 90%; border: 2px solid blue; ">
		
				<div dojoType="dijit.layout.ContentPane" region="center" style="background-color: #f5ffbf; padding: 30px;" role="main">
					<button onclick="componentGrid.setQuery('')">All</button>
					<button onclick="componentGrid.setQuery({enabled: true})">Accepted</button>
					<button onclick="componentGrid.setQuery({featured: true})">Featured</button>
					<span class="horizontal-rule"></span>
					<button onclick="componentGrid.setQuery({uploaded: new Date().getTime() - 864000})">New</button>
					<button onclick="requery('flagged')">Flagged</button>
					<!--<button onclick="requery('rejected')">Rejected</button>-->
					<input id="filter-box" type="text"></input>
					<table rowSelector="20px" rowsPerPage="20" query="''" store="prototypeStore" id="component-grid" jsid="componentGrid" dojoType="dojox.grid.DataGrid" style="height:300px">
						<thead>
							<tr>
								<th width="80px" field="status">Status</th>
								<th editable="true" width="auto" field="name">Name</th>
								<th width="80px" field="author">Author</th>
								<th width="80px" field="rating">Rating</th>
								<th width="80px" field="downloads">Downloads</th>
								<th width="80px" field="category">Category</th>
								<th width="80px" field="uploaded">Upload Date</th>
								<th width="80px">Delete</th>
							</tr>
						</thead>
					</table>    
				</div>
		        <div id="info-pane" jsid="infoPane" dojoType="dijit.layout.TabContainer" splitter="true" region="bottom" style="height:100px">
		        	<div id="component-actions">
		        		<button id="accept-button">Accept</button>
						<button id="reject-button">Reject</button>
					</div>
					<div id="info-tab" jsid="infoTab" dojoType="dijit.layout.ContentPane" title="Information" iconClass="plusIcon" tooltip="Information about component">
						<div id="info-description"></div>
						<div id="info-details">
							<hr />
							<span>Author:</span><span id="author-detail"></span>
							<hr />
							<span>Status:</span><span id="status-detail"></span>
							<hr />
							<span>Version:</span><span id="version-detail"></span>
							<hr />
							<span>Downloads:</span><span id="downloads-detail"></span>
							<hr />
							<span>Uploaded:</span><span id="uploaded-detail"></span>
							<hr />
							<span>Rating:</span><span id="rating-detail"></span>
							<hr />
							<span>Category:</span><span id="category-detail"></span>
							<hr />
							<button id="download">Download</button>
						</div>
					</div>
					<div id="source-tab" jsid="sourceTab" dojoType="dijit.layout.ContentPane" title="Source Code" iconClass="plusIcon" tooltip="Source Code">
					</div>
		        </div>
			</div>
			<div id="activity-tab" dojoType="dijit.layout.ContentPane" title="Activity Log" iconClass="plusIcon" tooltip="Activity Log">
				<h2>Activity Log</h2>
					<table rowSelector="20px" rowsPerPage="20" query="''" store="prototypeStore" id="activity-grid" jsid="activityGrid" dojoType="dojox.grid.DataGrid" style="height:300px">
						<thead>
							<tr>
								<th editable="true" width="80px" field="author">Author</th>
								<th editable="true" width="80px" field="status">Status</th>
								<th editable="true" width="auto" field="name">Name</th>
								<th editable="true" width="80px" field="uploaded">Upload Date</th>
							</tr>
						</thead>
					</table>    
				
			</div>

		</div>
	</div>

  	
  </body>
</html>