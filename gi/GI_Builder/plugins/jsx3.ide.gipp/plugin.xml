<!--
  ~ Copyright (c) 2001-2009, TIBCO Software Inc.
  ~ Use, modification, and distribution subject to terms of license.
  -->

<plugin xmlns="http://www.tibco.com/gi/amp"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.tibco.com/gi/amp http://gi.tibco.com/xsd/plugin.xsd"
        id="jsx3.ide.gipp"
        name="GIPP Integration Plug-In"
        version="0.1">

  <method id="launch">
    var gipp = this.getGIPPDir();
    var uri = gipp.toURI();
    uri = jsx3.net.URI.fromParts(uri.getScheme(), uri.getUserInfo(), uri.getHost(), uri.getPort(), uri.getPath() + "gipp.html",
        "GI=" + gipp.relativePathTo(jsx3.ide.getSystemRelativeFile("")) + "&amp;APP=" +
        gipp.relativePathTo(jsx3.ide.PROJECT.getDirectory()), "");
    window.open(uri.toString());
  </method>

  <method id="isConfigured">
    return this.isValidGIPP(this.getGIPPDir());
  </method>

  <method id="getGIPPDir">
    var p = jsx3.ide.getIDESettings().get(this.getId(), "path");
    return p ? jsx3.ide.getPlugIn("jsx3.io").getFileForURI(p) :
           jsx3.ide.getSystemRelativeFile(this.resolveURI("gipp"));
  </method>

  <method id="isValidGIPP" params="objFile">
    return objFile.resolve("gipp.html").isFile();
  </method>

  <requires>
  </requires>

  <resources>
    <xml id="pane_gipp" path="pane.xml"/>
  </resources>

  <extension point="jsx3.ide.settings.ide.pane" id="default">
    <pane label="GIPP" img="gipp.gif" resource="pane_gipp"
          tip="Settings related to the integration with General Interface&amp;#8482; Performance Profiler."/>
  </extension>

  <extension point="jsx3.ide.ui.action" id="menu.project">
    <action
        id="jsx3.ide.gipp.run"
        label="Run Project In GIPP..."
        tip="Run project in the General Interface Performance Profiler"
        menupath="/jsx3.ide.project/run" hkconfig="true"
        execute="this.getPlugIn().launch();"
        enabled="eval" enabled-eval="jsx3.ide.PROJECT &amp;&amp; this.getPlugIn().isConfigured()"/>
  </extension>

</plugin>
