<!--
  ~ Copyright (c) 2001-2009, TIBCO Software Inc.
  ~ Use, modification, and distribution subject to terms of license.
  -->
<serialization xmlns="urn:tibco.com/v3.0">
  <onAfterDeserialize><![CDATA[
objJSX.initializeTitle = function(buddy) {
  windowBar.setText(buddy.name||buddy.jid, true);
  this.contactName = buddy.name||buddy.jid;

  var xml = (new jsx3.xml.CDF.Document()).loadXML('<data jsxid="jsxroot"></data>');
  jsxconversationarea.setSourceXML(xml);
};
objJSX.onNewMessage = function(instance, msg) {
  if (!this.chatInstance || this.chatInstance.chatid != instance.chatid) {
    this.chatInstance = instance;
  }
  if (msg) {
    this.displayMessage(msg);
  }
};
objJSX.displayMessage = function(msg) {
  try {
    jsxconversationarea.insertRecord({
      jsxid: (new Date()).valueOf(),
      jsxcontactname: msg.from ? this.contactName : 'me',
      jsxtext: msg.body,
      jsxdate: new Date()
    }, null, true);
  } catch(e) {}
};
objJSX.sendMessage = function(evt) {
  if (evt) {
    if (!evt.enterKey() || evt.shiftKey()) {
      return;
    }
    evt.cancelKey();
    evt.cancelReturn();
    evt.cancelBubble();
  }
  try {
    var txt = jsxchatarea.getValue();
    txt = txt.replace(/\n/g, '<br/>');
    this.chatInstance.sendMessage({ body: txt });
    this.displayMessage({ body: txt });
    jsxchatarea.setValue('', true);
  } catch(e) {}
};
  ]]></onAfterDeserialize>
  <object type="jsx3.gui.Dialog">
    <variants jsxwidth="431" jsxheight="318" jsxzindex="5000" jsxwindowstate="1" jsxleft="70" jsxtop="31"/>
    <strings jsxname="jsx_chat_dialog"/>
    <dynamics jsxbgcolor="@Solid Medium"/>
    <object type="jsx3.gui.WindowBar">
      <variants/>
      <strings jsxname="windowBar" jsxtext="[Caption]"/>
      <object type="jsx3.gui.ToolbarButton">
        <variants/>
        <strings jsxname="btnMinimize"/>
        <dynamics jsximage="@Min Icon" jsxtip="jsx3.gui.Dialog.min"/>
        <events jsxexecute="this.getAncestorOfType(jsx3.gui.Dialog).doToggleState();"/>
      </object>
      <object type="jsx3.gui.ToolbarButton">
        <variants/>
        <strings jsxname="btnMaximize"/>
        <dynamics jsximage="@Max Icon" jsxtip="jsx3.gui.Dialog.max"/>
        <events jsxexecute="this.getAncestorOfType(jsx3.gui.Dialog).doMaximize(this);"/>
      </object>
      <object type="jsx3.gui.ToolbarButton">
        <variants/>
        <strings jsxname="btnClose"/>
        <dynamics jsximage="@Close Icon" jsxtip="jsx3.gui.Dialog.close"/>
        <events jsxexecute="this.getAncestorOfType(jsx3.gui.Dialog).doClose();"/>
      </object>
    </object>
    <object type="jsx3.gui.Block">
      <variants jsxoverflow="1" jsxloadtype="1"/>
      <strings jsxname="block" jsxwidth="100%" jsxheight="100%" jsxrelativeposition="1"/>
      <object type="jsx3.gui.LayoutGrid">
        <variants jsxrelativeposition="0" jsxleft="0" jsxtop="0" jsxoverflow="2"/>
        <strings jsxname="layoutRows" jsxrows="*,100" jsxwidth="100%" jsxheight="100%" jsxbgcolor=""/>
        <object type="jsx3.gui.Block">
          <variants jsxoverflow="2"/>
          <strings jsxname="pane1" jsxwidth="100%" jsxheight="100%"/>
          <dynamics jsxborder="@Outset"/>
          <object type="jsx3.gui.Matrix">
            <variants jsxpagingmodel="1" jsxselectionmodel="0" jsxscalewidth="1" jsxjsxxmlasync="1" jsxsort="0" jsxresize="0" jsxreorder="0" jsxautorow="0" jsxdrag="0" jsxdrop="0" jsxheaderheight="0"/>
            <strings jsxname="jsxconversationarea" jsxbodyborder="1px solid #dfdfef" jsxheaderborder="1px solid #dfdfef" jsxbgcolor="#efefff" jsxrenderingmodel="shallow"/>
            <events jsxexecute="jsx3.log('EVENT: (jsxexecute). Record: ' + strRECORDID);"/>
            <xslparameters jsx_rowbg1="#ffffff" jsx_rowbg2="#efefff"/>
            <object type="jsx3.gui.Matrix.Column">
              <variants jsxwidth="100" jsxsort="0" jsxresize="0"/>
              <strings jsxname="textColumn" jsxtext="Text" jsxpadding="2" jsxcellpadding="3" jsxpath="jsxcontactname"/>
              <dynamics jsxborder="@Outset" jsxbg="@Bevel TopDown" jsxbgcolor="@Solid Disabled"/>
            </object>
            <object type="jsx3.gui.Matrix.Column">
              <variants/>
              <strings jsxname="htmlColumn" jsxwidth="*" jsxtext="HTML" jsxvaluetemplate="@unescape" jsxpadding="2" jsxcellpadding="2" jsxpath="jsxtext" jsxformathandler="@unescape"/>
              <dynamics jsxborder="@Outset" jsxbg="@Bevel TopDown" jsxbgcolor="@Solid Disabled"/>
            </object>
            <object type="jsx3.gui.Matrix.Column">
              <variants/>
              <strings jsxname="dateColumn" jsxwidth="100" jsxtext="Date" jsxpadding="2" jsxcellpadding="2" jsxpath="jsxdate" jsxformathandler="@datetime,short" jsxdatatype="number"/>
              <dynamics jsxborder="@Outset" jsxbg="@Bevel TopDown" jsxbgcolor="@Solid Disabled"/>
            </object>
          </object>
        </object>
        <object type="jsx3.gui.Block">
          <variants jsxoverflow="1"/>
          <strings jsxname="pane2" jsxwidth="100%" jsxheight="100%"/>
          <dynamics jsxborder="@Outset"/>
          <object type="jsx3.gui.LayoutGrid">
            <variants jsxrelativeposition="0" jsxleft="0" jsxtop="0" jsxoverflow="2"/>
            <strings jsxname="layoutCols" jsxcols="*,100" jsxwidth="100%" jsxheight="100%"/>
            <object type="jsx3.gui.Block">
              <variants jsxoverflow="2"/>
              <strings jsxname="pane1" jsxwidth="100%" jsxheight="100%"/>
              <dynamics jsxborder="@Outset"/>
              <object type="jsx3.gui.TextBox">
                <variants jsxtype="1" jsxenabled="1"/>
                <strings jsxwidth="100%" jsxheight="100%" jsxname="jsxchatarea" jsxmargin="0 0 0 0" jsxvalue=""/>
                <events jsxkeypress="jsx_chat_dialog.sendMessage(objEVENT);" />
              </object>
            </object>
            <object type="jsx3.gui.Block">
              <variants jsxoverflow="1"/>
              <strings jsxname="pane2" jsxwidth="100%" jsxheight="100%"/>
              <dynamics jsxborder="@Outset"/>
              <object type="jsx3.gui.Button">
                <variants jsxindex="0"/>
                <strings jsxheight="100%" jsxname="jsxsend" jsxtext="Send" jsxmargin="auto" jsxwidth="100%" jsxtextalign="center"/>
                <events jsxexecute="jsx_chat_dialog.sendMessage();" />
              </object>
            </object>
          </object>
        </object>
      </object>
    </object>
  </object>
</serialization>
